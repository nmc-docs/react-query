"use strict";(self.webpackChunkhtml=self.webpackChunkhtml||[]).push([[590],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>h});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},i=Object.keys(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(r=0;r<i.length;r++)n=i[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),c=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):u(u({},t),e)),n},s=function(e){var t=c(e.components);return r.createElement(l.Provider,{value:t},e.children)},y="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,l=e.parentName,s=o(e,["components","mdxType","originalType","parentName"]),y=c(n),p=a,h=y["".concat(l,".").concat(p)]||y[p]||d[p]||i;return n?r.createElement(h,u(u({ref:t},s),{},{components:n})):r.createElement(h,u({ref:t},s))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,u=new Array(i);u[0]=p;var o={};for(var l in t)hasOwnProperty.call(t,l)&&(o[l]=t[l]);o.originalType=e,o[y]="string"==typeof e?e:a,u[1]=o;for(var c=2;c<i;c++)u[c]=n[c];return r.createElement.apply(null,u)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},3331:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>u,default:()=>d,frontMatter:()=>i,metadata:()=>o,toc:()=>c});var r=n(7462),a=(n(7294),n(3905));const i={sidebar_position:2},u="invalidateQueries()",o={unversionedId:"useQueryClient/invalidateQueries",id:"useQueryClient/invalidateQueries",title:"invalidateQueries()",description:"- Ph\u01b0\u01a1ng th\u1ee9c invalidateQueries() s\u1ebd refetch (g\u1eedi refetch request network) cho nh\u1eefng queries m\xe0 c\xf3 queryKey t\u01b0\u01a1ng \u1ee9ng do ta ch\u1ec9 \u0111\u1ecbnh ho\u1eb7c refetch t\u1ea5t c\u1ea3 c\xe1c queries \u0111ang c\xf3 trong cache.",source:"@site/docs/useQueryClient/invalidateQueries.md",sourceDirName:"useQueryClient",slug:"/useQueryClient/invalidateQueries",permalink:"/react-query/useQueryClient/invalidateQueries",draft:!1,tags:[],version:"current",sidebarPosition:2,frontMatter:{sidebar_position:2},sidebar:"tutorialSidebar",previous:{title:"Gi\u1edbi thi\u1ec7u",permalink:"/react-query/useQueryClient/introduce"},next:{title:"prefetchQuery()",permalink:"/react-query/useQueryClient/prefetchQuery"}},l={},c=[{value:"C\u1ea5u h\xecnh",id:"c\u1ea5u-h\xecnh",level:2}],s={toc:c},y="wrapper";function d(e){let{components:t,...n}=e;return(0,a.kt)(y,(0,r.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("h1",{id:"invalidatequeries"},"invalidateQueries()"),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Ph\u01b0\u01a1ng th\u1ee9c ",(0,a.kt)("inlineCode",{parentName:"li"},"invalidateQueries()")," s\u1ebd refetch (g\u1eedi ",(0,a.kt)("a",{parentName:"li",href:"../#ph%C3%A2n-bi%E1%BB%87t-hai-lo%E1%BA%A1i-request-trong-react-query"},"refetch request network"),") cho nh\u1eefng queries m\xe0 c\xf3 ",(0,a.kt)("inlineCode",{parentName:"li"},"queryKey")," t\u01b0\u01a1ng \u1ee9ng do ta ch\u1ec9 \u0111\u1ecbnh ho\u1eb7c refetch t\u1ea5t c\u1ea3 c\xe1c queries \u0111ang c\xf3 trong cache."),(0,a.kt)("li",{parentName:"ul"},"Ph\u01b0\u01a1ng n\xe0y ",(0,a.kt)("inlineCode",{parentName:"li"},"return Promise")," cho n\xean c\xf3 th\u1ec3 \u0111i k\xe8m v\u1edbi ",(0,a.kt)("inlineCode",{parentName:"li"},"await"))),(0,a.kt)("h2",{id:"c\u1ea5u-h\xecnh"},"C\u1ea5u h\xecnh"),(0,a.kt)("table",null,(0,a.kt)("thead",{parentName:"table"},(0,a.kt)("tr",{parentName:"thead"},(0,a.kt)("th",{parentName:"tr",align:null},"Config"),(0,a.kt)("th",{parentName:"tr",align:null},"Type"),(0,a.kt)("th",{parentName:"tr",align:null},"Description"))),(0,a.kt)("tbody",{parentName:"table"},(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"queryKey")),(0,a.kt)("td",{parentName:"tr",align:null},"Array"),(0,a.kt)("td",{parentName:"tr",align:null},"Ch\u1ec9 \u0111\u1ecbnh nh\u1eefng queries c\xf3 ",(0,a.kt)("inlineCode",{parentName:"td"},"queryKey")," t\u01b0\u01a1ng \u0111\u1ed1i kh\u1edbp v\u1edbi ",(0,a.kt)("inlineCode",{parentName:"td"},"queryKey")," ta ch\u1ec9 \u0111\u1ecbnh m\u1edbi b\u1ecb refetch")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"exact")),(0,a.kt)("td",{parentName:"tr",align:null},"Boolean"),(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"true"),": ch\u1ec9 refetch nh\u1eefng queries c\xf3 ",(0,a.kt)("inlineCode",{parentName:"td"},"queryKey")," kh\u1edbp ch\xednh x\xe1c tuy\u1ec7t \u0111\u1ed1i v\u1edbi ",(0,a.kt)("inlineCode",{parentName:"td"},"queryKey")," ta ch\u1ec9 \u0111\u1ecbnh")),(0,a.kt)("tr",{parentName:"tbody"},(0,a.kt)("td",{parentName:"tr",align:null},(0,a.kt)("inlineCode",{parentName:"td"},"predicate")),(0,a.kt)("td",{parentName:"tr",align:null},"Function"),(0,a.kt)("td",{parentName:"tr",align:null},"L\xe0 m\u1ed9t h\xe0m ",(0,a.kt)("inlineCode",{parentName:"td"},"return Boolean")," ch\u1ec9 \u0111\u1ecbnh nh\u1eefng queries n\xe0o th\u1ecfa m\xe3n \u0111i\u1ec1u ki\u1ec7n m\u1edbi \u0111\u01b0\u1ee3c refetch. D\xf9ng h\xe0m n\xe0y r\u1ed3i th\xec th\xf4i kh\xf4ng d\xf9ng ",(0,a.kt)("inlineCode",{parentName:"td"},"queryKey")," n\u1eefa.")))),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"V\xed d\u1ee5:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},"// Refetch l\u1ea1i t\u1ea5t c\u1ea3 c\xe1c query \u0111ang c\xf3 trong cache\nqueryClient.invalidateQueries();\n// Refetch l\u1ea1i t\u1ea5t c\u1ea3 c\xe1c query m\xe0 c\xf3 ph\u1ea7n t\u1eed \u0111\u1ea7u ti\xean trong m\u1ea3ng queryKey l\xe0 'todos'\nqueryClient.invalidateQueries({ queryKey: [\"todos\"] });\n")),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"V\u1ec1 ",(0,a.kt)("strong",{parentName:"li"},"query matching")," . Xem v\xed d\u1ee5 sau \u0111\xe2y:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'import { useQuery, useQueryClient } from "@tanstack/react-query";\n\n// L\u1ea5y instance QueryClient t\u1eeb context\nconst queryClient = useQueryClient();\n\nqueryClient.invalidateQueries({ queryKey: ["todos"] });\n\n// T\u1ea5t c\u1ea3 2 query sau s\u1ebd b\u1ecb refetch do \u0111\u1ec1u c\xf3 ph\u1ea7n t\u1eed \u0111\u1ea7u ti\xean c\u1ee7a m\u1ea3ng queryKey l\xe0 \'todos\'\nconst todoListQuery = useQuery({\n  queryKey: ["todos"],\n  queryFn: fetchTodoList,\n});\nconst todoListQuery = useQuery({\n  queryKey: ["todos", { page: 1 }],\n  queryFn: fetchTodoList,\n});\n')),(0,a.kt)("blockquote",null,(0,a.kt)("p",{parentName:"blockquote"},"\u0110\u1ec3 kh\u1eafc ph\u1ee5c v\u1ea5n \u0111\u1ec1 n\xe0y, ta th\xeam ",(0,a.kt)("inlineCode",{parentName:"p"},"exact: true")," trong c\u1ea5u h\xecnh ",(0,a.kt)("inlineCode",{parentName:"p"},"invalidateQueries()"),":")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'queryClient.invalidateQueries({\n  queryKey: ["todos"],\n  exact: true,\n});\n\n// Query d\u01b0\u1edbi \u0111\xe2y s\u1ebd \u0111\u01b0\u1ee3c refetch\nconst todoListQuery = useQuery({\n  queryKey: ["todos"],\n  queryFn: fetchTodoList,\n});\n\n// Tuy nhi\xean, query d\u01b0\u1edbi \u0111\xe2y s\u1ebd kh\xf4ng b\u1ecb refetch\nconst todoListQuery = useQuery({\n  queryKey: ["todos", { type: "done" }],\n  queryFn: fetchTodoList,\n});\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Thay v\xec ch\u1ec9 \u0111\u1ecbnh m\u1ed9t ",(0,a.kt)("inlineCode",{parentName:"li"},"queryKey")," c\u1ee5 th\u1ec3 \u0111\u1ec3 refetch, ta c\xf3 th\u1ec3 s\u1eed d\u1ee5ng ",(0,a.kt)("inlineCode",{parentName:"li"},"predicate")," trong c\u1ea5u h\xecnh ",(0,a.kt)("inlineCode",{parentName:"li"},"invalidateQueries()")," \u0111\u1ec3 ch\u1ec9 \u0111\u1ecbnh nh\u1eefng query n\xe0o th\u1ecfa m\xe3n \u0111i\u1ec1u ki\u1ec7n m\u1edbi \u0111\u01b0\u1ee3c refetch. V\xed d\u1ee5:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'queryClient.invalidateQueries({\n  predicate: (query) =>\n    query.queryKey[0] === "todos" && query.queryKey[1]?.version >= 10,\n});\n\n// Hai query sau s\u1ebd \u0111\u01b0\u1ee3c refetch\nconst todoListQuery = useQuery({\n  queryKey: ["todos", { version: 20 }],\n  queryFn: fetchTodoList,\n});\nconst todoListQuery = useQuery({\n  queryKey: ["todos", { version: 10 }],\n  queryFn: fetchTodoList,\n});\n\n// Tuy nhi\xean, query n\xe0y s\u1ebd kh\xf4ng \u0111\u01b0\u1ee3c refetch do version < 10\nconst todoListQuery = useQuery({\n  queryKey: ["todos", { version: 5 }],\n  queryFn: fetchTodoList,\n});\n')),(0,a.kt)("ul",null,(0,a.kt)("li",{parentName:"ul"},"Ph\u01b0\u01a1ng th\u1ee9c ",(0,a.kt)("inlineCode",{parentName:"li"},"invalidateQueries()")," ph\xf9 h\u1ee3p khi s\u1eed d\u1ee5ng v\u1edbi ",(0,a.kt)("inlineCode",{parentName:"li"},"useMutation()"),", n\xf3 s\u1ebd t\u1ef1 \u0111\u1ed9ng c\u1eadp nh\u1eadt d\u1eef li\u1ec7u hi\u1ec3n th\u1ecb \u1edf UI ngay l\u1eadp t\u1ee9c khi mutation th\u1ef1c thi th\xe0nh c\xf4ng. V\xed d\u1ee5:")),(0,a.kt)("pre",null,(0,a.kt)("code",{parentName:"pre",className:"language-ts"},'const postTaskMutation = useMutation({\n  mutationFn: httpPost,\n});\n\nconst queryClient = useQueryClient();\n\nconst handlePostTask = () => {\n  updateTaskMutation.mutate(\n    { name: "X", deadline: new Date() },\n    {\n      onSuccess: () => {\n        queryClient.invalidateQueries({ queryKey: ["tasks"] });\n      },\n    }\n  );\n};\n')))}d.isMDXComponent=!0}}]);